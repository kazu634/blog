---
title: Emacs内でのプロセス制御について
author: kazu634
date: 2009-11-29
url: /2009/11/29/_1407/
wordtwit_post_info:
  - 'O:8:"stdClass":13:{s:6:"manual";b:0;s:11:"tweet_times";i:1;s:5:"delay";i:0;s:7:"enabled";i:1;s:10:"separation";s:2:"60";s:7:"version";s:3:"3.7";s:14:"tweet_template";b:0;s:6:"status";i:2;s:6:"result";a:0:{}s:13:"tweet_counter";i:2;s:13:"tweet_log_ids";a:1:{i:0;i:4955;}s:9:"hash_tags";a:0:{}s:8:"accounts";a:1:{i:0;s:7:"kazu634";}}'
categories:
  - Emacs

---
<div class="section">
<p>
    Emacs-Lisp では、外部プログラムを二つの方法で呼び出すことが可能:
</p>
  
<ol>
<li>
      同期呼び出しで、起動した外部プロセスの終了を待つ方式
</li>
<li>
      非同期呼び出しで、プロセスをバックグラウンドで起動してその終了を待たずに次の Emacs-Lisp ステップに進む方式
</li>
</ol>
  
<h4>
    同期呼び出し
</h4>
  
<p>
    「call-process」を使うよ。使い方は:
</p>
  
<pre class="syntax-highlight">
<span class="synSpecial">(</span>call-process プログラム &#38;optional 入力ファイル 出力バッファ 表示 &#38;rest 引数...<span class="synSpecial">)</span>
<span class="synSpecial">(</span>call-process <span class="synConstant">&#34;ls&#34;</span> <span class="synStatement">nil</span> <span class="synStatement">t</span> <span class="synStatement">t</span> <span class="synConstant">&#34;-lF&#34;</span> <span class="synConstant">&#34;~/&#34;</span><span class="synSpecial">)</span>
</pre>
  
<dl>
<dt>
      プログラム
</dt>
    
<dd>
      起動するプログラムを指定する
</dd>
    
<dt>
      入力ファイル
</dt>
    
<dd>
      起動プログラムの標準入力として与えるファイルを指定します
</dd>
    
<dt>
      出力バッファ
</dt>
    
<dd>
      起動プログラムが画面出力した内容を受け取るバッファを指定します。 t を与えるとカレントバッファを指定したことになります。 nil を与えると、すべての出力を捨てます。また、 0 を与えると、出力を捨て、かつ起動プログラムを Emacs の管轄から切り離して、プログラムの出力を待ちません
</dd>
    
<dt>
      表示
</dt>
    
<dd>
      non-nil を指定すると、起動プログラムからの出力がバッファに挿入されるごとに画面を更新します
</dd>
    
<dt>
      引数
</dt>
    
<dd>
      起動プログラムに与える引数を文字列で指定します
</dd>
</dl>
  
<h4>
    非同期呼び出し
</h4>
  
<p>
    「start-process」を使うよ。使い方は:
</p>
  
<pre class="syntax-highlight">
<span class="synSpecial">(</span>start-process <span class="synConstant">&#34;プロセス名&#34;</span> バッファ プログラム &#38;rest 引数<span class="synSpecial">)</span>
<span class="synSpecial">(</span>start-process <span class="synConstant">&#34;Search file&#34;</span> <span class="synConstant">&#34;*scratch*&#34;</span> <span class="synConstant">&#34;find&#34;</span> <span class="synConstant">&#34;/&#34;</span> <span class="synConstant">&#34;-name&#34;</span> <span class="synConstant">&#34;*.bak&#34;</span> <span class="synConstant">&#34;-ls&#34;</span><span class="synSpecial">)</span>
</pre>
  
<p>
    このような形で用いると、 scratch バッファにfindのコマンド結果が出力される。 Emacs はプロセス名でコマンドを管理する。プロセスの状態を知りたいときは「process-status」を用いる。
</p>
  
<p>
    非同期で実行したプロセスの状態が変化した時に呼び出される関数を「監視関数」と呼び、次の関数で設定します:
</p>
  
<pre class="syntax-highlight">
<span class="synSpecial">(</span>set-process-sentinel プロセス 監視関数<span class="synSpecial">)</span>
</pre>
  
<p>
    監視関数は少なくとも「プロセス」と「プロセスの状態」の二つを引数とします。
</p>
  
<div class="hatena-asin-detail">
<a href="http://www.amazon.co.jp/dp/4906391702/?tag=hatena_st1-22&ascsubtag=d-7ibv" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.amazon.co.jp/dp/4906391702/?tag=hatena_st1-22&ascsubtag=d-7ibv', '');"><img src="https://images-na.ssl-images-amazon.com/images/I/51C4N4SHT7L._SL160_.jpg" class="hatena-asin-detail-image" alt="やさしいEmacs‐Lisp講座" title="やさしいEmacs‐Lisp講座" /></a></p> 
    
<div class="hatena-asin-detail-info">
<p class="hatena-asin-detail-title">
<a href="http://www.amazon.co.jp/dp/4906391702/?tag=hatena_st1-22&ascsubtag=d-7ibv" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.amazon.co.jp/dp/4906391702/?tag=hatena_st1-22&ascsubtag=d-7ibv', 'やさしいEmacs‐Lisp講座');">やさしいEmacs‐Lisp講座</a>
</p>
      
<ul>
<li>
<span class="hatena-asin-detail-label">作者:</span> <a href="http://d.hatena.ne.jp/keyword/%B9%AD%C0%A5%CD%BA%C6%F3" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://d.hatena.ne.jp/keyword/%B9%AD%C0%A5%CD%BA%C6%F3', '広瀬雄二');" class="keyword">広瀬雄二</a>
</li>
<li>
<span class="hatena-asin-detail-label">出版社/メーカー:</span> <a href="http://d.hatena.ne.jp/keyword/%A5%AB%A5%C3%A5%C8%A5%B7%A5%B9%A5%C6%A5%E0" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://d.hatena.ne.jp/keyword/%A5%AB%A5%C3%A5%C8%A5%B7%A5%B9%A5%C6%A5%E0', 'カットシステム');" class="keyword">カットシステム</a>
</li>
<li>
<span class="hatena-asin-detail-label">発売日:</span> 1999/01
</li>
<li>
<span class="hatena-asin-detail-label">メディア:</span> 単行本
</li>
<li>
<span class="hatena-asin-detail-label">購入</span>: 4人 <span class="hatena-asin-detail-label">クリック</span>: 145回
</li>
<li>
<a href="http://d.hatena.ne.jp/asin/4906391702" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://d.hatena.ne.jp/asin/4906391702', 'この商品を含むブログ (30件) を見る');" target="_blank">この商品を含むブログ (30件) を見る</a>
</li>
</ul>
</div>
    
<div class="hatena-asin-detail-foot">
</div>
</div>
</div>
